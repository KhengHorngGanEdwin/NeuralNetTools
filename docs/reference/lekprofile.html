<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Sensitivity analysis using Lek's profile method — lekprofile • NeuralNetTools</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Sensitivity analysis using Lek's profile method — lekprofile" />

<meta property="og:description" content="Conduct a sensitivity analysis of model responses in a neural network to input variables using Lek's profile method" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NeuralNetTools</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.5.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Sensitivity analysis using Lek's profile method</h1>
    
    <div class="hidden name"><code>lekprofile.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Conduct a sensitivity analysis of model responses in a neural network to input variables using Lek's profile method</p>
    
    </div>

    <pre class="usage"><span class='fu'>lekprofile</span>(<span class='no'>mod_in</span>, <span class='no'>...</span>)

<span class='co'># S3 method for default</span>
<span class='fu'>lekprofile</span>(<span class='no'>mod_in</span>, <span class='no'>xvars</span>, <span class='kw'>ysel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>xsel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>steps</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>group_vals</span> <span class='kw'>=</span> <span class='fu'>seq</span>(<span class='fl'>0</span>, <span class='fl'>1</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='fl'>0.2</span>), <span class='kw'>val_out</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>group_show</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>grp_nms</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>position</span> <span class='kw'>=</span> <span class='st'>"dodge"</span>, <span class='no'>...</span>)

<span class='co'># S3 method for nnet</span>
<span class='fu'>lekprofile</span>(<span class='no'>mod_in</span>, <span class='kw'>xsel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>ysel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='co'># S3 method for mlp</span>
<span class='fu'>lekprofile</span>(<span class='no'>mod_in</span>, <span class='no'>xvars</span>, <span class='no'>yvars</span>, <span class='kw'>xsel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>ysel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>)

<span class='co'># S3 method for train</span>
<span class='fu'>lekprofile</span>(<span class='no'>mod_in</span>, <span class='kw'>xsel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>ysel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='co'># S3 method for nn</span>
<span class='fu'>lekprofile</span>(<span class='no'>mod_in</span>, <span class='kw'>xsel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>ysel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>mod_in</th>
      <td><p>input object for which an organized model list is desired.  The input can be an object of class <code>nnet</code> or <code>mlp</code></p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>arguments passed to other methods</p></td>
    </tr>
    <tr>
      <th>xvars</th>
      <td><p><code><a href='http://www.rdocumentation.org/packages/base/topics/data.frame'>data.frame</a></code> of explanatory variables used to create the input model, only needed for <code>mlp</code> objects</p></td>
    </tr>
    <tr>
      <th>ysel</th>
      <td><p>chr string indicating which response variables to plot if more than one, defaults to all</p></td>
    </tr>
    <tr>
      <th>xsel</th>
      <td><p>chr string of names of explanatory variables to plot, defaults to all</p></td>
    </tr>
    <tr>
      <th>steps</th>
      <td><p>numeric value indicating number of observations to evaluate for each explanatory variable from minimum to maximum value, default 100</p></td>
    </tr>
    <tr>
      <th>group_vals</th>
      <td><p>numeric vector with values from 0-1 indicating quantile values at which to hold other explanatory variables constant or a single value indicating number of clusters to define grouping scheme, see details</p></td>
    </tr>
    <tr>
      <th>val_out</th>
      <td><p>logical value indicating if actual sensitivity values are returned rather than a plot, default <code>FALSE</code></p></td>
    </tr>
    <tr>
      <th>group_show</th>
      <td><p>logical if a barplot is returned that shows the values at which explanatory variables were held constant while not being evaluated</p></td>
    </tr>
    <tr>
      <th>grp_nms</th>
      <td><p>optional chr string of alternative names for groups in legend</p></td>
    </tr>
    <tr>
      <th>position</th>
      <td><p>chr string indicating bar position (e.g., 'dodge', 'fill', 'stack'), passed to <code><a href='http://www.rdocumentation.org/packages/ggplot2/topics/geom_bar'>geom_bar</a></code>, used if <code>group_show = TRUE</code></p></td>
    </tr>
    <tr>
      <th>yvars</th>
      <td><p><code><a href='http://www.rdocumentation.org/packages/base/topics/data.frame'>data.frame</a></code> of explanatory variables used to create the input model, only needed for <code>mlp</code> objects</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code><a href='http://www.rdocumentation.org/packages/ggplot2/topics/ggplot'>ggplot</a></code> object for plotting if <code>val_out  =  FALSE</code>, otherwise a two-element <code>list</code> is returned with a <code>data.frame</code> in long form showing the predicted responses at different values of the explanatory variables and the grouping scheme that was used to hold unevaluated variables constant.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The Lek profile method is described briefly in Lek et al. 1996 and in more detail in Gevrey et al. 2003. The profile method is fairly generic and can be extended to any statistical model in R with a predict method.  However, it is one of few methods used to evaluate sensitivity in neural networks.</p>
<p>The profile method can be used to evaluate the effect of explanatory variables by returning a plot of the predicted response across the range of values for each separate variable.  The original profile method evaluated the effects of each variable while holding the remaining explanatory variables at different quantiles (e.g., minimum, 20th percentile, maximum).  This is implemented in in the function by creating a matrix of values for explanatory variables where the number of rows is the number of observations and the number of columns is the number of explanatory variables. All explanatory variables are held at their mean (or other constant value) while the variable of interest is sequenced from its minimum to maximum value across the range of observations. This matrix (or data frame) is then used to predict values of the response variable from a fitted model object. This is repeated for each explanatory variable to obtain all response curves.  Values passed to <code>group_vals</code> must range from zero to one to define the quantiles for holding unevaluated explanatory variables.</p>
<p>An alternative implementation of the profile method is to group the unevaluated explanatory variables using groupings defined by the statistical properties of the data.  Covariance among predictors may present unlikely scenarios if holding all unevaluated variables at the same level.  To address this issue, the function provides an option to hold unevaluated variable at mean values defined by natural clusters in the data.  <code><a href='http://www.rdocumentation.org/packages/stats/topics/kmeans'>kmeans</a></code> clustering is used on the input <code>data.frame</code> of explanatory variables if the argument passed to <code>group_vals</code> is an integer value greater than one.  The centers of the clusters are then used as constant values for the unevaluated variables.  An arbitrary grouping scheme can also be passed to <code>group_vals</code> as a <code>data.frame</code> where the user can specify exact values for holding each value constant (see the examples).</p>
<p>For all plots, the legend with the 'Groups' label indicates the colors that correspond to each group.  The groups describe the values at which unevaluated explanatory variables were held constant, either as specific quantiles, group assignments based on clustering, or in the arbitrary grouping defined by the user.  The constant values of each explanatory variable for each group can be viewed as a barplot by using <code>group_show = TRUE</code>.</p>
<p>Note that there is no predict method for neuralnet objects from the nn package.  The lekprofile method for nn objects uses the nnet package to recreate the input model, which is then used for the sensitivity predictions.  This approach only works for networks with one hidden layer.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Beck, M.W. 2018. NeuralNetTools: Visualization and Analysis Tools for Neural Networks. Journal of Statistical Software. 85(11):1-20.</p>
<p>Lek, S., Delacoste, M., Baran, P., Dimopoulos, I., Lauga, J., Aulagnier, S. 1996. Application of neural networks to modelling nonlinear relationships in Ecology. Ecological Modelling. 90:39-52.</p>
<p>Gevrey, M., Dimopoulos, I., Lek, S. 2003. Review and comparison of methods to study the contribution of variables in artificial neural network models. Ecological Modelling. 160:249-264.</p>
<p>Olden, J.D., Joy, M.K., Death, R.G. 2004. An accurate comparison of methods for quantifying variable importance in artificial neural networks using simulated data. Ecological Modelling. 178:389-397.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>## using nnet</span>

<span class='fu'>library</span>(<span class='no'>nnet</span>)

<span class='fu'>set.seed</span>(<span class='fl'>123</span>)

<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/nnet/topics/nnet'>nnet</a></span>(<span class='no'>Y1</span> ~ <span class='no'>X1</span> + <span class='no'>X2</span> + <span class='no'>X3</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>neuraldat</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>5</span>)</div><div class='output co'>#&gt; # weights:  26
#&gt; initial  value 259.012592 
#&gt; iter  10 value 0.986480
#&gt; iter  20 value 0.225311
#&gt; iter  30 value 0.139585
#&gt; iter  40 value 0.098961
#&gt; iter  50 value 0.038200
#&gt; iter  60 value 0.022839
#&gt; iter  70 value 0.013774
#&gt; iter  80 value 0.008530
#&gt; iter  90 value 0.005172
#&gt; iter 100 value 0.003044
#&gt; final  value 0.003044 
#&gt; stopped after 100 iterations</div><div class='input'>
<span class='fu'>lekprofile</span>(<span class='no'>mod</span>)</div><div class='img'><img src='lekprofile-1.png' alt='' width='700' height='433' /></div><div class='input'>
</div><span class='co'># NOT RUN {</span>
<span class='co'>## using RSNNS, no bias layers</span>

<span class='fu'>library</span>(<span class='no'>RSNNS</span>)

<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='no'>neuraldat</span>[, <span class='fu'>c</span>(<span class='st'>'X1'</span>, <span class='st'>'X2'</span>, <span class='st'>'X3'</span>)]
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>neuraldat</span>[, <span class='st'>'Y1'</span>, <span class='kw'>drop</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>]

<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/RSNNS/topics/mlp'>mlp</a></span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>5</span>)

<span class='fu'>lekprofile</span>(<span class='no'>mod</span>, <span class='kw'>xvars</span> <span class='kw'>=</span> <span class='no'>x</span>)

<span class='co'>## using neuralnet</span>

<span class='fu'>library</span>(<span class='no'>neuralnet</span>)

<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/neuralnet/topics/neuralnet'>neuralnet</a></span>(<span class='no'>Y1</span> ~ <span class='no'>X1</span> + <span class='no'>X2</span> + <span class='no'>X3</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>neuraldat</span>, <span class='kw'>hidden</span> <span class='kw'>=</span> <span class='fl'>5</span>)

<span class='fu'>lekprofile</span>(<span class='no'>mod</span>)

<span class='co'>## back to nnet, not using formula to create model</span>
<span class='co'>## y variable must have a name attribute</span>

<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/nnet/topics/nnet'>nnet</a></span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>5</span>)

<span class='fu'>lekprofile</span>(<span class='no'>mod</span>)

<span class='co'>## using caret</span>

<span class='fu'>library</span>(<span class='no'>caret</span>)

<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/RSNNS/topics/train'>train</a></span>(<span class='no'>Y1</span> ~ <span class='no'>X1</span> + <span class='no'>X2</span> + <span class='no'>X3</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>'nnet'</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>neuraldat</span>, <span class='kw'>linout</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>lekprofile</span>(<span class='no'>mod</span>)

<span class='co'>## group by clusters instead of sequencing by quantiles</span>

<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/nnet/topics/nnet'>nnet</a></span>(<span class='no'>Y1</span> ~ <span class='no'>X1</span> + <span class='no'>X2</span> + <span class='no'>X3</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>neuraldat</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>5</span>)

<span class='fu'>lekprofile</span>(<span class='no'>mod</span>, <span class='kw'>group_vals</span> <span class='kw'>=</span> <span class='fl'>6</span>) <span class='co'># six clusters</span>

<span class='co'>## enter an arbitrary grouping scheme for the group values</span>
<span class='co'>## i.e. hold all values at 0.5</span>
<span class='no'>group_vals</span> <span class='kw'>&lt;-</span> <span class='fu'>rbind</span>(<span class='fu'>rep</span>(<span class='fl'>0.5</span>, <span class='kw'>length</span> <span class='kw'>=</span> <span class='fu'>ncol</span>(<span class='no'>x</span>)))
<span class='no'>group_vals</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='no'>group_vals</span>)
<span class='fu'>names</span>(<span class='no'>group_vals</span>) <span class='kw'>&lt;-</span> <span class='fu'>names</span>(<span class='no'>group_vals</span>)

<span class='fu'>lekprofile</span>(<span class='no'>mod</span>, <span class='kw'>group_vals</span> <span class='kw'>=</span> <span class='no'>group_vals</span>, <span class='kw'>xsel</span> <span class='kw'>=</span> <span class='st'>'X3'</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Marcus W. Beck.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

